<div class="flex flex-col h-full items-center justify-center bg-slate-100">

	<div *ngIf="productState().type === 'loading', else success">
		<p>Cargando producto...</p>
	</div>

	<ng-template #success>
		<div class="p-12 bg-white mx-auto rounded-2xl w-full sm:max-w-[500px] shadow-md">
			<div class="mb-4">
				<h3 class="font-semibold text-2xl text-gray-800">¡Actualiza!</h3>
				<p class="text-gray-500">Rellene el formulario con todos los datos.</p>
			</div>
			<form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-5">
				<div class="form-group space-y-2">
					<label class="text-sm font-medium text-gray-700 tracking-wide">Título</label>
					<input type="text" formControlName="title"
						class="form-control w-full text-base px-4 py-2 border  border-gray-300 rounded-lg focus:outline-none focus:border-green-400"
						[ngClass]="{ 'is-invalid': submitted && f['title'].errors }" />
					@if (submitted && f['title'].errors) {
					<div class="invalid-feedback">
						@if (f['title'].errors['required']) {
						<div class="text-red-500">Título requerido</div>
						}@if (f['title'].errors['minlength']) {
						<div class="text-red-500">Longitud mínima: {{ minLenght }}</div>
						} @if (f['title'].errors['maxlength']) {
						<div class="text-red-500">Lóngitud máxima permitida: {{ maxLenght }}</div>
						}
					</div>
					}
				</div>
				<div class="form-group space-y-2">
					<label class="text-sm font-medium text-gray-700 tracking-wide">Precio</label>
					<input type="number" formControlName="price"
						class="form-control w-full text-base px-4 py-2 border  border-gray-300 rounded-lg focus:outline-none focus:border-green-400"
						[ngClass]="{ 'is-invalid': submitted && f['price'].errors }" />
					@if (submitted && f['price'].errors) {
					<div class="invalid-feedback">
						@if (f['price'].errors['required']) {
						<div class="text-red-500">Título requerido</div>
						}
					</div>
					}
				</div>
				<div class="form-group space-y-2">
					<label class="text-sm font-medium text-gray-700 tracking-wide">Descripción</label>
					<input type="text" formControlName="desc"
						class="form-control w-full text-base px-4 py-2 border  border-gray-300 rounded-lg focus:outline-none focus:border-green-400"
						[ngClass]="{ 'is-invalid': submitted && f['desc'].errors }" />
					@if (submitted && f['desc'].errors) {
					<div class="invalid-feedback">
						@if (f['desc'].errors['required']) {
						<div class="text-red-500">Correo electrónico requerido</div>
						} @if (f['desc'].errors['minlength']) {
						<div class="text-red-500">Longitud mínima: {{ minLenght }}</div>
						} @if (f['desc'].errors['maxlength']) {
						<div class="text-red-500">Lóngitud máxima permitida: {{ maxLenght }}</div>
						}
					</div>
					}
				</div>
				<div class="space-y-2">
					<label class="text-sm font-medium text-gray-700 tracking-wide">Imágenes</label>
					<app-image-drop></app-image-drop>
					<div class="form-group space-y-2">
						<app-list-images *ngIf="productState().data.images.length > 0; else noimages"
							(deleteImage)="deleteImage($event)" [images]="productState().data.images"></app-list-images>
						<ng-template #noimages>
							<p class="text-gray-500">No hay imágenes guardadas</p>
						</ng-template>
						<input type="hidden" formControlName="img" value="{{productState().data.images}}" />
						<div class="invalid-feedback">
							@if (submitted && productState().data.images.length <= 0) {
							<div class="text-red-500">Imagen requerida</div>
							}
						</div>
					</div>
				</div>
				<!-- <div class="form-group space-y-2">
					<label class="text-sm font-medium text-gray-700 tracking-wide">Imagen</label>
					<input type="text" formControlName="img"
						class="form-control w-full text-base px-4 py-2 border  border-gray-300 rounded-lg focus:outline-none focus:border-green-400"
						[ngClass]="{ 'is-invalid': submitted && f['img'].errors }" />
					@if (submitted && f['img'].errors) {
					<div class="invalid-feedback">
						@if (f['img'].errors['required']) {
						<div class="text-red-500">Imagen requerida</div>
						}
					</div>
					}
				</div> -->
				<div class="flex justify-center">
					<app-product-button *ngIf="updateProductState().type === 'initial'" [title]="'Actualizar producto'"
						[submit]="!isLoading" [isDisabled]="isLoading"></app-product-button>
					<app-product-button *ngIf="updateProductState().type === 'loading'"
						[title]="'Actualizando producto...'" [isDisabled]="true"></app-product-button>
				</div>
			</form>
			<div class="flex justify-center pt-8">
				<p-confirmDialog></p-confirmDialog>
				<app-red-button *ngIf="deleteProductState().type === 'initial'" [title]="'Eliminar'"
					(action)="onDelete($event!)" [isDisabled]="isLoading"></app-red-button>
				<app-red-button *ngIf="deleteProductState().type === 'loading'" [title]="'Eliminando...'"
					(action)="onDelete($event!)" [isDisabled]="true"></app-red-button>
			</div>
		</div>
	</ng-template>
</div>